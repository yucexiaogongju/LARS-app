import streamlit as st
import pandas as pd
import joblib
import time
import warnings
import os

# é¡µé¢é…ç½®
st.set_page_config(
    page_title="ç›´è‚ æœ¯åLARSé£é™©é¢„æµ‹å·¥å…·",
    layout="centered",
    initial_sidebar_state="collapsed"
)

# åˆå§‹åŒ–session_state
if 'show_form' not in st.session_state:
    st.session_state.show_form = False
if 'has_predicted' not in st.session_state:
    st.session_state.has_predicted = False
if 'pred_result' not in st.session_state:
    st.session_state.pred_result = None
if 'input_data' not in st.session_state:
    st.session_state.input_data = None

# -------------------------- é¡µé¢æ ‡é¢˜ä¸èº«ä»½é€‰æ‹© --------------------------
st.title("ç›´è‚ æœ¯åLARSé£é™©é¢„æµ‹å·¥å…·")
st.divider()

st.subheader("è¯·é€‰æ‹©æ‚¨çš„èº«ä»½")
user_type = st.radio(
    "èº«ä»½ç±»å‹",
    ["ğŸ‘¨â€âš•ï¸ åŒ»æŠ¤å·¥ä½œè€…", "ğŸ‘¨â€ğŸ‘©â€ğŸ‘§â€ğŸ‘¦ æ‚£è€…/å®¶å±"],
    horizontal=True,
    key="user_type"
)
st.divider()

# -------------------------- åº”ç”¨ä»‹ç» --------------------------
st.subheader("åº”ç”¨ä»‹ç»")
st.markdown("""
æˆ‘ä»¬æ˜¯**å››å·å¤§å­¦åè¥¿åŒ»é™¢ç›´è‚ æœ¯åä½ä½å‰åˆ‡é™¤ç»¼åˆå¾ï¼ˆLARSï¼‰åŒ»æŠ¤ç ”ç©¶å›¢é˜Ÿ**ï¼ŒåŸºäºä¸´åºŠå¤§æ•°æ®ä¸éšæœºæ£®æ—æœºå™¨å­¦ä¹ ç®—æ³•ï¼Œå¼€å‘äº†æœ¬é£é™©é¢„æµ‹å·¥å…·ã€‚

<font size="4">å·¥å…·æ ¸å¿ƒç”¨é€”ï¼šé¢„æµ‹ç›´è‚ ç™Œæ‚£è€…<b>æœ¯å6ä¸ªæœˆ</b>å†…å‘ç”ŸLARSçš„é£é™©ï¼Œä¸ºä¸´åºŠåŒ»æŠ¤å·¥ä½œè€…æä¾›æœ¯åç®¡ç†å†³ç­–æ”¯æŒï¼Œä¹Ÿå¸®åŠ©æ‚£è€…åŠå®¶å±æå‰äº†è§£åº·å¤é£é™©ï¼Œè¾…åŠ©åˆ¶å®šä¸ªæ€§åŒ–è‡ªæˆ‘æŠ¤ç†æ–¹æ¡ˆã€‚</font>
""", unsafe_allow_html=True)  # å¯ç”¨HTMLæ”¯æŒ

# å‚è€ƒæ–‡çŒ®
st.markdown("#### å›¢é˜Ÿç›¸å…³ç ”ç©¶æˆæœ")  # å°†###æ”¹ä¸º####å‡å°æ ‡é¢˜å­—ä½“
st.markdown("""
<span style="font-size:14px">1. æ±ªæ™“ä¸œ, é»„æ˜å›, æç«‹, ç­‰. ç»“ç›´è‚ ç™Œæœ¯åLARSé¢„æµ‹æ¨¡å‹çš„æ„å»ºæ–¹æ³•åŠé¢„æµ‹ç³»ç»Ÿ[P]. ä¸­å›½ä¸“åˆ©: ZL 2023 1 0088636.5, 2023-05-02.</span>  
<span style="font-size:14px">2. Ye L, Huang MJ, Huang YW, et al. Risk factors of postoperative low anterior resection syndrome for colorectal cancer: A meta-analysis[J]. Asian Journal of Surgery, 2022, 45: 39-50.</span>  
<span style="font-size:14px">3. å¼ çº¯, æ—é›¨æ˜•, æç³, ç­‰. ç›´è‚ ç™Œæœ¯åä½ä½å‰åˆ‡é™¤ç»¼åˆå¾çš„é£é™©é¢„æµ‹æ¨¡å‹æ„å»ºï¼šåŸºäºéšæœºæ£®æ—ç®—æ³•[J]. ä¸­å›½æ™®å¤–åŸºç¡€ä¸ä¸´åºŠæ‚å¿—, 2025, 32(7): 845-852.</span>
""", unsafe_allow_html=True)  # ç»Ÿä¸€è®¾ç½®æ–‡çŒ®å†…å®¹å­—ä½“å¤§å°
st.divider()

# åç»­ä»£ç ä¿æŒä¸å˜...
# -------------------------- æ¨¡å‹åŠ è½½ --------------------------
st.subheader("æ¨¡å‹åŠ è½½çŠ¶æ€")
model_path = 'lars_risk_model.pkl'
model_loaded = False
model = None

try:
    with st.spinner("æ¨¡å‹æ­£åœ¨åŠ è½½ä¸­ï¼Œè¯·ç¨å€™..."):
        with warnings.catch_warnings():
            warnings.simplefilter("ignore")
            model = joblib.load(model_path)
    st.success("âœ… æ¨¡å‹åŠ è½½æˆåŠŸï¼ç‚¹å‡»ä¸‹æ–¹ã€Œå¼€å§‹é¢„æµ‹ã€æŒ‰é’®è¿›å…¥è¾“å…¥ç•Œé¢")
    model_loaded = True
    if hasattr(model, 'n_features_in_'):
        st.write(f"ğŸ”§ æ¨¡å‹è¦æ±‚ç‰¹å¾æ•°é‡ï¼š{model.n_features_in_}ï¼ˆå½“å‰è¾“å…¥ä¸º8ä¸ªç‰¹å¾ï¼Œå·²åŒ¹é…ï¼‰")
except Exception as e:
    st.error(f"âŒ æ¨¡å‹åŠ è½½å¤±è´¥ï¼š{str(e)}")
    st.warning("é¢„æµ‹åŠŸèƒ½æš‚æ—¶ä¸å¯ç”¨ï¼Œè¯·æ£€æŸ¥æ¨¡å‹æ–‡ä»¶æ˜¯å¦å­˜åœ¨æˆ–è”ç³»å¼€å‘è€…")
    if st.checkbox("æŸ¥çœ‹å½“å‰ç›®å½•æ–‡ä»¶ï¼ˆè°ƒè¯•ç”¨ï¼‰"):
        st.write("å½“å‰ç›®å½•æ–‡ä»¶åˆ—è¡¨ï¼š", os.listdir('.'))
st.divider()

# -------------------------- é¢„æµ‹æ ¸å¿ƒé€»è¾‘ --------------------------
if model_loaded:
    # æ˜¾ç¤º"å¼€å§‹é¢„æµ‹"æŒ‰é’®
    if not st.session_state.show_form and not st.session_state.has_predicted:
        if st.button("ğŸ“Š å¼€å§‹é¢„æµ‹", type="primary", use_container_width=True):
            st.session_state.show_form = True

    # ç‰¹å¾è¾“å…¥è¡¨å•
    if st.session_state.show_form:
        with st.form("prediction_form", clear_on_submit=False):
            st.markdown("### è¯·è¾“å…¥ä»¥ä¸‹8é¡¹ç‰¹å¾ä¿¡æ¯")
            
            # 1. å¹´é¾„
            age = st.number_input("å¹´é¾„ï¼ˆå²ï¼‰", min_value=0.0, max_value=120.0, value=50.0, step=1.0, format="%.0f", key="age")
            # 2. BMI
            BMI = st.number_input("BMIï¼ˆä½“é‡/èº«é«˜Â² kg/mÂ²ï¼‰", min_value=10.0, max_value=50.0, value=22.0, step=0.1, format="%.1f", key="bmi")
            # 3. è‚¿ç˜¤è·è‚›é—¨è·ç¦»
            tumor_dist = st.number_input("è‚¿ç˜¤è·è‚›é—¨è·ç¦»ï¼ˆcmï¼‰", min_value=0.0, max_value=50.0, value=5.0, step=0.1, format="%.1f", key="tumor_dist")
            # 4. æ‰‹æœ¯æ—¶é—´
            surg_time = st.number_input("æ‰‹æœ¯æ—¶é—´ï¼ˆåˆ†é’Ÿï¼‰", min_value=0.0, max_value=600.0, value=180.0, step=1.0, format="%.0f", key="surg_time")
            # 5. æœ¯åé¦–æ¬¡æ’æ°”å¤©æ•°
            exhaust = st.number_input("æœ¯åé¦–æ¬¡æ’æ°”å¤©æ•°ï¼ˆæ‰“å±ï¼‰", min_value=0.0, max_value=30.0, value=2.0, step=0.5, format="%.1f", key="exhaust")
            # 6. è‚¿ç˜¤å¤§å°
            tumor_size = st.number_input("è‚¿ç˜¤å¤§å°ï¼ˆé•¿Ã—å®½ cmÂ²ï¼‰", min_value=0.1, max_value=50.0, value=3.0, step=0.1, format="%.1f", key="tumor_size")
            # 7. TNMåˆ†æœŸï¼ˆç—…ç†â†’ä¸´åºŠæ¢ç®—ï¼‰
            st.markdown("ğŸ“Œ **TNMåˆ†æœŸæ¢ç®—è¯´æ˜**ï¼ˆæ¨¡å‹ä½¿ç”¨ä¸´åºŠåˆ†æœŸï¼Œå¯ä»ç—…å†ç—…ç†åˆ†æœŸæŸ¥è¯¢å¯¹åº”å€¼ï¼‰ï¼š")
            tnm_conversion = pd.DataFrame({
                "ä¸´åºŠåˆ†æœŸï¼ˆæ¨¡å‹è¾“å…¥å€¼ï¼‰": ["1æœŸï¼ˆè¾“å…¥1ï¼‰", "2æœŸï¼ˆè¾“å…¥2ï¼‰", "3æœŸï¼ˆè¾“å…¥3ï¼‰", "4æœŸï¼ˆè¾“å…¥4ï¼‰"],
                "å¯¹åº”ç—…ç†TNMåˆ†æœŸï¼ˆç—…å†æŠ¥å‘Šï¼‰": [
                    "T1-2N0M0ï¼ˆè‚¿ç˜¤ä¾µçŠ¯é»è†œ/è‚Œå±‚ï¼Œæ— æ·‹å·´ç»“åŠè¿œå¤„è½¬ç§»ï¼‰",
                    "T3-4N0M0ï¼ˆè‚¿ç˜¤ä¾µçŠ¯æµ†è†œ/é‚»è¿‘å™¨å®˜ï¼Œæ— æ·‹å·´ç»“åŠè¿œå¤„è½¬ç§»ï¼‰",
                    "ä»»ä½•Tï¼ŒN1-2M0ï¼ˆä»»ä½•è‚¿ç˜¤æ·±åº¦ï¼Œæœ‰åŒºåŸŸæ·‹å·´ç»“è½¬ç§»ï¼Œæ— è¿œå¤„è½¬ç§»ï¼‰",
                    "ä»»ä½•Tï¼Œä»»ä½•Nï¼ŒM1ï¼ˆä»»ä½•è‚¿ç˜¤æ·±åº¦åŠæ·‹å·´ç»“çŠ¶æ€ï¼Œæœ‰è¿œå¤„è½¬ç§»ï¼‰"
                ]
            })
            st.dataframe(tnm_conversion, use_container_width=True)
            
            if user_type == "ğŸ‘¨â€âš•ï¸ åŒ»æŠ¤å·¥ä½œè€…":
                TNM = st.number_input("TNMä¸´åºŠåˆ†æœŸ", 
                                     min_value=1.0, max_value=4.0, value=2.0, step=1.0, format="%.0f", key="tnm")
            else:
                tnm_options = {"IæœŸï¼ˆå¯¹åº”ç—…ç†T1-2N0M0ï¼‰":1.0, 
                               "IIæœŸï¼ˆå¯¹åº”ç—…ç†T3-4N0M0ï¼‰":2.0, 
                               "IIIæœŸï¼ˆå¯¹åº”ç—…ç†ä»»ä½•Tï¼ŒN1-2M0ï¼‰":3.0, 
                               "IVæœŸï¼ˆå¯¹åº”ç—…ç†ä»»ä½•Tï¼Œä»»ä½•Nï¼ŒM1ï¼‰":4.0}
                tnm_selected = st.selectbox("TNMä¸´åºŠåˆ†æœŸï¼ˆå¯å¯¹ç…§ç—…å†ç—…ç†åˆ†æœŸé€‰æ‹©ï¼‰", list(tnm_options.keys()), key="tnm_select")
                TNM = tnm_options[tnm_selected]
            
            # 8. æ–°è¾…åŠ©æ²»ç–—
            if user_type == "ğŸ‘¨â€âš•ï¸ åŒ»æŠ¤å·¥ä½œè€…":
                neoadjuvant = st.number_input("æ˜¯å¦æ–°è¾…åŠ©æ²»ç–—ï¼ˆ0=å¦ï¼Œ1=æ˜¯ï¼‰", min_value=0.0, max_value=1.0, value=0.0, step=1.0, format="%.0f", key="neo")
            else:
                neo_options = {"å¦":0.0, "æ˜¯":1.0}
                neo_selected = st.selectbox("æ˜¯å¦æ¥å—æœ¯å‰è¾…åŠ©æ²»ç–—ï¼ˆæ”¾ç–—/åŒ–ç–—ï¼‰", list(neo_options.keys()), key="neo_select")
                neoadjuvant = neo_options[neo_selected]
            
            # æäº¤æŒ‰é’®
            submit_btn = st.form_submit_button("ğŸ” æäº¤å¹¶é¢„æµ‹", type="primary")
        
        # æäº¤åæ‰§è¡Œé¢„æµ‹
        if submit_btn:
            try:
                input_data = pd.DataFrame([[
                    age, BMI, tumor_dist, surg_time, exhaust, tumor_size, TNM, neoadjuvant
                ]], columns=['age', 'BMI', 'tumor_dist', 'surg_time', 'exhaust', 'tumor_size', 'TNM', 'neoadjuvant'])
                
                if input_data.shape[1] != model.n_features_in_:
                    st.error(f"âŒ è¾“å…¥ç‰¹å¾æ•°é‡ä¸åŒ¹é…ï¼æ¨¡å‹éœ€è¦{model.n_features_in_}ä¸ªç‰¹å¾ï¼Œå½“å‰è¾“å…¥{input_data.shape[1]}ä¸ª")
                else:
                    with st.spinner("æ­£åœ¨è®¡ç®—é£é™©ç»“æœ..."):
                        prediction = model.predict(input_data)[0]
                        time.sleep(1)
                    
                    st.session_state.pred_result = prediction
                    st.session_state.input_data = input_data
                    st.session_state.has_predicted = True
                    st.session_state.show_form = False
            
            except Exception as e:
                st.error(f"é¢„æµ‹è¿‡ç¨‹å‡ºé”™ï¼š{str(e)}")
                st.warning("è¯·æ£€æŸ¥è¾“å…¥æ•°å€¼æ˜¯å¦åˆç†ï¼Œæˆ–æ¨¡å‹æ˜¯å¦æ­£å¸¸åŠ è½½")
    
    # æ˜¾ç¤ºé¢„æµ‹ç»“æœ
    if st.session_state.has_predicted and st.session_state.pred_result is not None:
        st.success("### é¢„æµ‹ç»“æœå·²ç”Ÿæˆ")
        prediction = st.session_state.pred_result
        input_data = st.session_state.input_data
        
        if prediction == 1:
            st.error("âš ï¸ é¢„æµ‹ç»“è®ºï¼šå­˜åœ¨LARSé£é™©")
            if user_type == "ğŸ‘¨â€âš•ï¸ åŒ»æŠ¤å·¥ä½œè€…":
                st.markdown("""
                **ä¸´åºŠå»ºè®®**ï¼š
                1. åŠ å¼ºæœ¯åéšè®¿ï¼Œé‡ç‚¹ç›‘æµ‹è‚ é“åŠŸèƒ½ï¼ˆæ’ä¾¿é¢‘ç‡ã€å¤±ç¦æƒ…å†µï¼‰ï¼›
                2. è€ƒè™‘åº·å¤å¹²é¢„ï¼ˆç›†åº•è‚Œè®­ç»ƒã€ç”Ÿç‰©åé¦ˆæ²»ç–—ï¼‰ï¼›
                3. å¿…è¦æ—¶ç»„ç»‡å¤šå­¦ç§‘ä¼šè¯Šï¼ˆå¤–ç§‘ã€åº·å¤ç§‘ã€è¥å…»ç§‘ï¼‰ï¼›
                4. åˆ¶å®šä¸ªæ€§åŒ–é¥®é£Ÿä¸æ’ä¾¿ç®¡ç†æ–¹æ¡ˆã€‚
                """)
            else:
                st.markdown("""
                **åº·å¤å»ºè®®**ï¼š
                1. æ‚¨å¯èƒ½å­˜åœ¨æœ¯åè‚ é“åŠŸèƒ½å¼‚å¸¸çš„é£é™©ï¼›
                2. è¯·åŠæ—¶ä¸ä¸»æ²»åŒ»ç”Ÿæ²Ÿé€šï¼Œäº†è§£æ›´å¤šå…³äºLARSç®¡ç†æªæ–½ï¼›
                3. éµå¾ªåŒ»å˜±è¿›è¡Œåº·å¤è®­ç»ƒï¼ˆå¦‚ç¼©è‚›è¿åŠ¨ï¼‰ï¼Œæ”¹å–„æ’ä¾¿æ§åˆ¶ï¼›
                4. é¥®é£Ÿè°ƒæ•´ï¼šå°‘é£Ÿå¤šé¤ï¼Œé¿å…é«˜çº¤ç»´ã€æ²¹è…»é£Ÿç‰©ï¼Œå‡å°‘è‚ é“åˆºæ¿€ï¼›
                5. å®šæœŸå¤æŸ¥ï¼Œå¯†åˆ‡å…³æ³¨æ’ä¾¿å¼‚å¸¸å˜åŒ–ï¼›
                6. ä¿æŒç§¯æå¿ƒæ€ï¼šLARSç—‡çŠ¶å¤šåœ¨æœ¯å6-12ä¸ªæœˆé€æ¸ç¼“è§£ï¼Œè§„èŒƒç®¡ç†å¯æ˜¾è‘—æ”¹å–„ç”Ÿæ´»è´¨é‡ã€‚
                """)
        else:
            st.success("âœ… é¢„æµ‹ç»“è®ºï¼šæ— æ˜æ˜¾LARSé£é™©")
            if user_type == "ğŸ‘¨â€âš•ï¸ åŒ»æŠ¤å·¥ä½œè€…":
                st.markdown("""
                **ä¸´åºŠå»ºè®®**ï¼š
                1. æŒ‰å¸¸è§„æµç¨‹è¿›è¡Œæœ¯åç®¡ç†ï¼Œå®šæœŸéšè®¿ï¼›
                2. å‘æ‚£è€…æ™®åŠLARSé¢„é˜²çŸ¥è¯†ï¼ˆé¥®é£Ÿã€è¿åŠ¨æŒ‡å¯¼ï¼‰ï¼›
                3. é¼“åŠ±æ‚£è€…ä¿æŒå¥åº·ç”Ÿæ´»æ–¹å¼ï¼Œé™ä½æ½œåœ¨é£é™©ã€‚
                """)
            else:
                st.markdown("""
                **å¥åº·å»ºè®®**ï¼š
                1. å½“å‰è¯„ä¼°æ˜¾ç¤ºæ‚¨çš„é£é™©è¾ƒä½ï¼›
                2. ç»§ç»­ä¿æŒæœ¯ååº·å¤ä¹ æƒ¯ï¼Œé¿å…è¿‡åº¦åŠ³ç´¯ï¼›
                3. éµåŒ»å˜±è¿›è¡Œåº·å¤ï¼Œä¿æŒå¥åº·çš„ç”Ÿæ´»ä¹ æƒ¯ï¼›
                4. å®šæœŸå¤æŸ¥ï¼Œå…³æ³¨èº«ä½“çŠ¶å†µï¼›
                5. å³ä½¿é£é™©è¾ƒä½ï¼Œä»å»ºè®®æ‚¨äº†è§£å…³äºç›´è‚ æœ¯ålARSçš„ç›¸å…³ä¿¡æ¯ï¼›
                6. è‹¥å‡ºç°æ’ä¾¿å¼‚å¸¸ï¼ˆå¦‚é¢‘ç¹è…¹æ³»ã€å¤±ç¦ï¼‰ï¼ŒåŠæ—¶å°±åŒ»å’¨è¯¢ã€‚
                """)
        
        # è¾“å…¥ä¿¡æ¯æ ¸å¯¹
        st.markdown("### è¾“å…¥ä¿¡æ¯æ ¸å¯¹")
        summary_data = {
            "ç‰¹å¾åç§°": ["å¹´é¾„", "BMIï¼ˆä½“é‡/èº«é«˜Â² kg/mÂ²ï¼‰", "è‚¿ç˜¤è·è‚›é—¨è·ç¦»", "æ‰‹æœ¯æ—¶é—´", "æœ¯åé¦–æ¬¡æ’æ°”å¤©æ•°ï¼ˆæ‰“å±ï¼‰", "è‚¿ç˜¤å¤§å°ï¼ˆé•¿Ã—å®½ cmÂ²ï¼‰", "TNMä¸´åºŠåˆ†æœŸ", "æ–°è¾…åŠ©æ²»ç–—"],
            "æ‚¨è¾“å…¥çš„å€¼": [
                f"{input_data.iloc[0]['age']:.0f}å²",
                f"{input_data.iloc[0]['BMI']:.1f}kg/mÂ²",
                f"{input_data.iloc[0]['tumor_dist']:.1f}cm",
                f"{input_data.iloc[0]['surg_time']:.0f}åˆ†é’Ÿ",
                f"{input_data.iloc[0]['exhaust']:.1f}å¤©",
                f"{input_data.iloc[0]['tumor_size']:.1f}cmÂ²",
                f"{int(input_data.iloc[0]['TNM'])}æœŸ",
                "æ˜¯" if input_data.iloc[0]['neoadjuvant'] == 1.0 else "å¦"
            ]
        }
        st.dataframe(pd.DataFrame(summary_data), use_container_width=True)
        
        # é‡æ–°é¢„æµ‹æŒ‰é’®
        if st.button("ğŸ”„ é‡æ–°é¢„æµ‹", use_container_width=True):
            st.session_state.show_form = False
            st.session_state.has_predicted = False
            st.session_state.pred_result = None
            st.session_state.input_data = None

# -------------------------- ä½¿ç”¨è¯´æ˜ --------------------------
st.divider()
with st.expander("ğŸ“‹ ä½¿ç”¨è¯´æ˜", expanded=False):
    st.markdown("""
    1. é€‰æ‹©æ‚¨çš„èº«ä»½ï¼ˆåŒ»æŠ¤å·¥ä½œè€…/æ‚£è€…å®¶å±ï¼‰ï¼›
    2. æŸ¥çœ‹æ¨¡å‹åŠ è½½çŠ¶æ€ï¼ˆæ˜¾ç¤ºâ€œåŠ è½½æˆåŠŸâ€æ–¹å¯é¢„æµ‹ï¼‰ï¼›
    3. ç‚¹å‡»ã€Œå¼€å§‹é¢„æµ‹ã€æŒ‰é’®ï¼Œå¡«å†™8é¡¹ç‰¹å¾ä¿¡æ¯ï¼ˆTNMåˆ†æœŸè¯·å¯¹ç…§ç—…å†çš„ç—…ç†åˆ†æœŸï¼Œå‚è€ƒè¡¨å•å†…çš„æ¢ç®—è¡¨ï¼‰ï¼›
    4. ç‚¹å‡»ã€Œæäº¤å¹¶é¢„æµ‹ã€ï¼Œç­‰å¾…1-2ç§’åæŸ¥çœ‹ç»“æœï¼›
    5. å¦‚éœ€é‡æ–°é¢„æµ‹ï¼Œç‚¹å‡»ã€Œé‡æ–°é¢„æµ‹ã€æŒ‰é’®å³å¯ã€‚
    """)

# -------------------------- æ–°å¢ï¼šäº†è§£æ›´å¤šå…³äºLARSï¼ˆåˆ†åŒ»æŠ¤/æ‚£è€…ç«¯ï¼‰ --------------------------
st.divider()
with st.expander("ğŸ“š äº†è§£æ›´å¤šå…³äºLARS", expanded=False):
    # èº«ä»½åˆ‡æ¢æŒ‰é’®ï¼ˆç‹¬ç«‹äºä¸»èº«ä»½é€‰æ‹©ï¼Œæ–¹ä¾¿äº¤å‰æŸ¥çœ‹ï¼‰
    info_user_type = st.radio(
        "æŸ¥çœ‹è§†è§’",
        ["ğŸ‘¨â€âš•ï¸ åŒ»æŠ¤ä¸“ä¸šè§†è§’", "ğŸ‘¨â€ğŸ‘©â€ğŸ‘§â€ğŸ‘¦ æ‚£è€…å®¶å±è§†è§’"],
        horizontal=True,
        key="info_user_type"
    )
    
    # åŒ»æŠ¤ä¸“ä¸šè§†è§’
    if info_user_type == "ğŸ‘¨â€âš•ï¸ åŒ»æŠ¤ä¸“ä¸šè§†è§’":
        st.markdown("### ä¸€ã€å®šä¹‰")
        st.markdown("""
        LARSæ˜¯ç›´è‚ ç™Œä¿è‚›æœ¯åå‘ç”Ÿçš„è‚ é“åŠŸèƒ½éšœç¢ç»¼åˆå¾ï¼Œæ ¸å¿ƒå®šä¹‰ä¸ºï¼š
        - æœ¯åå‡ºç°â‰¥1ç§æ’ä¾¿å¼‚å¸¸ç—‡çŠ¶ï¼ˆå¦‚å¤±ç¦ã€ä¾¿æ€¥ã€æ’ç©ºå›°éš¾ç­‰ï¼‰ï¼›
        - ç—‡çŠ¶å¯¼è‡´â‰¥1ç§ç”Ÿæ´»è´¨é‡å—æŸç»“å±€ï¼ˆå¦‚ç¤¾äº¤å—é™ã€å¿ƒç†å½±å“ç­‰ï¼‰ï¼›
        - å‘ç”Ÿç‡é«˜è¾¾60%~90%ï¼Œé‡åº¦LARSå‘ç”Ÿç‡çº¦41%ï¼Œéƒ¨åˆ†æ‚£è€…ç—‡çŠ¶æŒç»­æ•°å¹´ã€‚
        """)
        
        st.markdown("### äºŒã€ä¸´åºŠè¡¨ç°ï¼ˆ3ç§è¡¨å‹ï¼‰")
        st.markdown("""
        1. å‚¨ä¾¿éšœç¢å‹ï¼šä»¥å¤§ä¾¿å¤±ç¦ã€æ’ä¾¿æ€¥è¿«æ„Ÿã€æ’ä¾¿é¢‘æ¬¡å¢åŠ ä¸ºæ ¸å¿ƒï¼›
        2. æ’ç©ºéšœç¢å‹ï¼šè¡¨ç°ä¸ºæ’ä¾¿è´¹åŠ›ã€æ’ä¾¿ä¸å°½æ„Ÿã€éœ€æ‰‹åŠ©æ’ä¾¿ï¼›
        3. æ··åˆéšœç¢å‹ï¼šå…¼å…·å‚¨ä¾¿ä¸æ’ç©ºéšœç¢ç—‡çŠ¶ï¼Œä¸´åºŠæœ€å¸¸è§ã€‚
        """)
        
        st.markdown("### ä¸‰ã€å‘ç”Ÿæœºåˆ¶")
        st.markdown("""
        1. æ–°ç›´è‚ åŠŸèƒ½éšœç¢ï¼šå‚¨ä¾¿å®¹é‡å‡å°‘ã€é¡ºåº”æ€§é™ä½ï¼Œè‚ é“åŠ¨åŠ›å¼‚å¸¸ï¼›
        2. ç¥ç»æŸä¼¤ï¼šæ‰‹æœ¯æŸä¼¤ç›†è…”è‡ªä¸»ç¥ç»ï¼ˆä¸Šè…¹ä¸‹ç¥ç»ä¸›ã€ç›†ä¸›ç­‰ï¼‰ï¼Œå½±å“æ’ä¾¿åå°„ï¼›
        3. è‚›é—¨æ‹¬çº¦è‚ŒåŠŸèƒ½å—æŸï¼šTMEæ‰‹æœ¯æˆ–ISRæ‰‹æœ¯å¯¼è‡´æ‹¬çº¦è‚Œç»“æ„/åŠŸèƒ½æŸä¼¤ï¼›
        4. æ”¾ç–—ç›¸å…³æŸä¼¤ï¼šæ–°è¾…åŠ©æ”¾ç–—è¯±å¯¼ç›´è‚ å£çº¤ç»´åŒ–ã€é»è†œæ„Ÿè§‰éšœç¢ï¼›
        5. å»åˆå£å¹¶å‘ç—‡ï¼šå»åˆå£æ¼å¼•å‘ç›†è…”ç‚ç—‡ï¼Œè¿›ä¸€æ­¥åŠ é‡åŠŸèƒ½éšœç¢ã€‚
        """)
        
        st.markdown("### å››ã€æ¨èç®¡ç†ç­–ç•¥ï¼ˆé˜¶æ¢¯å¼æ²»ç–—ï¼‰")
        st.markdown("""
        1. ä¸€çº¿æ²»ç–—ï¼šé¥®é£Ÿè°ƒæ•´+è¯ç‰©æ²»ç–—ï¼ˆæ­¢æ³»è¯ã€5-HT3å—ä½“æ‹®æŠ—å‰‚ç­‰ï¼‰+ç›†åº•åº·å¤ï¼ˆç”Ÿç‰©åé¦ˆã€å‡¯æ ¼å°”è®­ç»ƒï¼‰ï¼›
        2. äºŒçº¿æ²»ç–—ï¼šç»è‚›çŒæ´—ï¼ˆTAIï¼‰ã€ç»çš®èƒ«ç¥ç»åˆºæ¿€ï¼ˆPTNSï¼‰ã€é’ˆç¸ï¼›
        3. ä¸‰çº¿æ²»ç–—ï¼šéª¶ç¥ç»è°ƒèŠ‚ï¼ˆSNMï¼‰ã€é¡ºè¡Œç»“è‚ çŒæ´—ï¼ˆACEï¼‰ï¼›
        4. ç»ˆæœ«æ²»ç–—ï¼šæ°¸ä¹…æ€§è‚ é€ å£ï¼ˆä»…ç”¨äºé‡åº¦éš¾æ²»æ€§ç—…ä¾‹ï¼‰ï¼›
        5. å…¨ç¨‹ç®¡ç†ï¼šå¤šå­¦ç§‘å›¢é˜Ÿï¼ˆå¤–ç§‘ã€åº·å¤ç§‘ã€è¥å…»ç§‘ï¼‰åä½œï¼ŒåŠ¨æ€è°ƒæ•´æ–¹æ¡ˆã€‚
        """)
    
    # æ‚£è€…å®¶å±è§†è§’
    else:
        st.markdown("### ä¸€ã€ä»€ä¹ˆæ˜¯LARSï¼Ÿ")
        st.markdown("""
        LARSæ˜¯â€œä½ä½å‰åˆ‡é™¤ç»¼åˆå¾â€çš„ç®€ç§°ï¼Œç®€å•è¯´å°±æ˜¯ç›´è‚ ä¿è‚›æ‰‹æœ¯åï¼Œè‚ é“åŠŸèƒ½å‡ºç°çš„ä¸€ç³»åˆ—é—®é¢˜ï¼Œæ¯”å¦‚æ’ä¾¿ä¸è§„å¾‹ã€æ§åˆ¶ä¸ä½æ’ä¾¿ç­‰ã€‚
        - è¿™æ˜¯æœ¯åå¸¸è§æƒ…å†µï¼Œå¾ˆå¤šæ‚£è€…éƒ½ä¼šå‡ºç°ï¼Œä¸æ˜¯æ‰‹æœ¯å¤±è´¥ï¼›
        - ç—‡çŠ¶é€šå¸¸åœ¨æœ¯å6-12ä¸ªæœˆé€æ¸å¥½è½¬ï¼Œå°‘æ•°äººå¯èƒ½æŒç»­ä¹…ä¸€äº›ï¼›
        - ä¸»è¦å½±å“ç”Ÿæ´»è´¨é‡ï¼Œé€šè¿‡è§„èŒƒç®¡ç†å¤§å¤šèƒ½æ˜¾è‘—æ”¹å–„ã€‚
        """)
        
        st.markdown("### äºŒã€å¯èƒ½ä¼šå‡ºç°å“ªäº›è¡¨ç°ï¼Ÿ")
        st.markdown("""
        1. æ§åˆ¶ä¸ä½æ’ä¾¿ï¼šæ¯”å¦‚æ”¾å±æ—¶æ¼ä¾¿ã€ç¨€ä¾¿å¤±ç¦ï¼Œéœ€è¦ç»å¸¸ç”¨æŠ¤å«ï¼›
        2. æ’ä¾¿å¤ªæ€¥ï¼šçªç„¶æƒ³æ’ä¾¿ï¼Œæ¥ä¸åŠå»å•æ‰€ï¼›
        3. æ’ä¾¿é¢‘ç¹ï¼šä¸€å¤©è¦æ’å¥½å‡ æ¬¡ï¼Œæ¯æ¬¡é‡ä¸å¤šï¼›
        4. æ’ä¾¿è´¹åŠ›ï¼šè¹²å¾ˆä¹…æ’ä¸å‡ºï¼Œæˆ–æ€»è§‰å¾—æ²¡æ’å¹²å‡€ï¼›
        5. æ··åˆæƒ…å†µï¼šåˆæœ‰æ’ä¾¿æ€¥ï¼Œåˆæœ‰æ’ä¾¿è´¹åŠ›ï¼Œäº¤æ›¿å‡ºç°ã€‚
        """)
        
        st.markdown("### ä¸‰ã€ä¸ºä»€ä¹ˆä¼šå‡ºç°è¿™äº›é—®é¢˜ï¼Ÿ")
        st.markdown("""
        1. æ‰‹æœ¯åˆ‡é™¤äº†éƒ¨åˆ†ç›´è‚ ï¼Œæ–°çš„è‚ é“å‚¨å­˜ç²ªä¾¿çš„â€œå®¹é‡â€å˜å°äº†ï¼Œå®¹æ˜“æœ‰ä¾¿æ„ï¼›
        2. æ‰‹æœ¯ä¸­å¯èƒ½å½±å“äº†æ§åˆ¶æ’ä¾¿çš„ç¥ç»ï¼Œå¯¼è‡´æ’ä¾¿åå°„ä¸çµæ•ï¼›
        3. è‚›é—¨å‘¨å›´çš„è‚Œè‚‰åŠŸèƒ½éœ€è¦æ—¶é—´æ¢å¤ï¼Œæœ¯åæ—©æœŸæ§åˆ¶èƒ½åŠ›ä¼šå¼±ä¸€äº›ï¼›
        4. æœ¯å‰æ”¾ç–—å¯èƒ½è®©è‚ é“é»è†œå˜å¾—æ•æ„Ÿï¼Œå®¹æ˜“å‡ºç°è…¹æ³»ã€ä¾¿æ€¥ã€‚
        """)
        
        st.markdown("### å››ã€æ€ä¹ˆç®¡ç†å’Œæ”¹å–„ï¼Ÿ")
        st.markdown("""
        1. é¥®é£Ÿè°ƒæ•´ï¼šå°‘é£Ÿå¤šé¤ï¼Œé¿å…è¾›è¾£ã€æ²¹è…»ã€ç”Ÿå†·é£Ÿç‰©ï¼Œå¤šåƒæ˜“æ¶ˆåŒ–çš„é£Ÿç‰©å’Œå¯æº¶æ€§è†³é£Ÿçº¤ç»´ï¼›
        2. ç”Ÿæ´»ä¹ æƒ¯ï¼šå…»æˆå®šæ—¶æ’ä¾¿çš„ä¹ æƒ¯ï¼ˆæ¯”å¦‚æ—©é¤åï¼‰ï¼Œç¡å‰2å°æ—¶åˆ«åƒä¸œè¥¿ï¼›
        3. åº·å¤è®­ç»ƒï¼šæŒ‰åŒ»ç”ŸæŒ‡å¯¼åšå‡¯æ ¼å°”è¿åŠ¨ï¼ˆç¼©è‚›è®­ç»ƒï¼‰ï¼Œå¢å¼ºè‚›é—¨è‚Œè‚‰åŠ›é‡ï¼›
        4. åŠæ—¶å°±åŒ»ï¼šå¦‚æœç—‡çŠ¶ä¸¥é‡ï¼ˆæ¯”å¦‚é¢‘ç¹å¤±ç¦ï¼‰ï¼ŒåŠæ—¶å‘Šè¯‰åŒ»ç”Ÿï¼Œå¯é€šè¿‡è¯ç‰©ã€åº·å¤æ²»ç–—æˆ–å…¶ä»–åŒ»ç–—æ‰‹æ®µæ”¹å–„ï¼›
        5. å¿ƒæ€è°ƒæ•´ï¼šåˆ«å¤ªç„¦è™‘ï¼ŒLARSæ˜¯æœ¯åæ­£å¸¸æ¢å¤è¿‡ç¨‹ï¼Œç§¯æé…åˆåŒ»ç”Ÿç®¡ç†å°±èƒ½æ…¢æ…¢å¥½è½¬ã€‚
        """)

# -------------------------- åº•éƒ¨å£°æ˜ --------------------------
st.divider()
st.markdown("""
âš ï¸ **å£°æ˜**ï¼šæœ¬å·¥å…·ä»…ä¾›ä¸´åºŠè¾…åŠ©å†³ç­–åŠæ‚£è€…ç§‘æ™®å‚è€ƒï¼Œä¸èƒ½æ›¿ä»£ä¸“ä¸šåŒ»ç”Ÿçš„è¯Šæ–­ä¸æ²»ç–—æ–¹æ¡ˆã€‚
""", unsafe_allow_html=False)

